{% extends "base.html" %}
{% load bt %}
{% load i18n %}
{% block styles %}
  <link rel="stylesheet" type="text/css" media="all" href="{% media_url %}/css/jquery.autocomplete.css" />
{% endblock %}

{% block scripts %}
<script type="text/javascript" src="{%media_url%}/js/tinymce/tiny_mce.js"></script>
<script type="text/javascript" src="{%media_url%}/js/jquery.1.4.2.min.js"></script>
<script type="text/javascript" src="{%media_url%}/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="{%media_url%}/js/jquery.tablesorter.min.js"> </script>
<script type="text/javascript" src="{%media_url%}/js/form.js"></script>
<script type="text/javascript">
function focushandlers(ed) {
    var s = ed.settings;
    var realID = $('#'+ed.id+'_tbl');
    tinymce.dom.Event.add(ed.getWin(), 'focus', function(e) {
        if($(realID)) {
            //console.log(realID);
            realID.parents('.fieldWrapper').find('.help_text').show();
        }
    });
    tinymce.dom.Event.add(ed.getWin(), 'blur', function(e) {
        if($(realID)) {
            //console.log(realID);
            realID.parents('.fieldWrapper').find('.help_text').hide();
        }
    });
}
$(document).ready(function(){
  init_form();
  {% if not form.is_bound %}
  $(".fieldWrapper").hide();
  $("#id_country").parent().parent().show();
  $("#id_operator").parent().parent().show();
  $("#id_contract").parent().parent().show();
  $("#id_media").parent().parent().show();
  $("#save_button").hide();
  {% else %}
  if($("#id_contractual").attr('checked')==false) {
    $("#id_contract_excerpt").parent().parent().hide();
  }
  $("#show_optionals").show();
  $("#optional .fieldWrapper").hide();
  if ($('#id_email').val().length>0) {
                               $('#id_captcha_0').parent().parent().show();
                               $('#save_button').removeAttr('disabled');
                               $("#show_optionals").show();
                             }
  {% endif %}
  $("#sortedlist").tablesorter();
  $('.confirm_form').submit(function() {
     var self=this;
     $.ajax({url: '/confirm/'+$(this).attr('id')+'/'+$(this).children('input:first').attr('value'), success: function(data) { $(self).html(data); }});
     return false;
     });
   tinyMCE.init({
               mode : "textareas",
               width : "284",
               height : "140",
               theme : "advanced",
               theme_advanced_toolbar_align : "left",
               theme_advanced_toolbar_location : "top",
               theme_advanced_buttons1 : "bold,italic,underline,bullist,numlist,outdent,indent,blockquote,undo,",
               theme_advanced_buttons2 : "",
               theme_advanced_buttons3 : "",
               plugins : "paste",
               paste_auto_cleanup_on_paste : true,
               paste_strip_class_attributes: 'all',
               paste_remove_styles: true,
               init_instance_callback: focushandlers,
               valid_elements : "@[id|title|dir<ltr?rtl|lang|xml::lang],a[rel|rev|"
                                + "charset|hreflang|name|href|title],strong/b,em/i,"
                                + "strike,u,p,-ol,-ul,-li,br,-sub,-sup,-blockquote,"
                                + ",-code,-pre,address,-h1,-h2,-h3,-h4,-h5,"
                                + "-h6,hr[size|noshade],dd,dl,dt,cite,abbr,acronym,"
                                + "del[datetime|cite],ins[datetime|cite]",
             });
   $(".confirm > .button").click(function(){
            $(this).parent().parent().parent().find('.info-validate').toggle();
         });
   $(".cancel-button").click(function(){
            $(this).parent().parent().hide();
         });
});
</script>
{% endblock %}

{%block content%}
<div id='global'>
  {% if messages %}
  <ul class="messages">
    {% for message in messages %}
    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endfor %}
  </ul>
  {% endif %}
  <div id='addForm' class='index'>
    <h2>{% trans "Add New Infringement" %}</h2>
    <form name="addForm" enctype="multipart/form-data" action="{% root_url %}/add/" method="post">
      {% for field in form %}
      {% if field.html_name = 'resource' %}<div id="show_optionals">{% trans "Provide optional details" %}</div><div id="optional">{%endif%}
      <div class="fieldWrapper">
         {% if field.help_text %}<span class="help_text">{{ field.help_text }}</span>{% endif %}
        <span class="innerfield">
          {{ field.errors }}
          {{ field.label_tag }} {{ field }}
        </span>
      </div>
      {% endfor %}
    </div>
    {% csrf_token %}
    <input id="save_button" type="submit" value="{% trans "save" %}" />
    </form>
  </div>
  <div id='content'>
   <h2>{% trans "On Internet, you decide what you do, right? Not anymore!" %}</h2>
     <p>{% trans "We all rely more and more on our access to Internet to do serious things like find jobs and fun things like chat with friends. But telco's are increasingly trying to control your behavior online, by restricting the things you are doing on the internet. Now you have a chance to do something about that!" %}</p>
     <p>{% trans "Help us chart all the ways that internet providers are violating our online freedom: Is your operator blocking or throttling your Internet communications, for instance by making it impossible to use chat programs or charging extra for Internet telephony? Let us know by filling up this form (it takes less than two minutes!). We will make sure that the relevant authorities are informed, so that we can put an end to this." %}</p>
   <h2>{% trans "Latest Infringements" %}</h2>
  <table>
    <thead>
      <tr>
        <th>{% trans "Infringing offering" %}</th>
        <th>{% trans "Confirmed" %}</th>
        <th>{% trans "I Confirm" %}</th>
      </tr>
    </thead>
  <tbody>
  {% for violation in violations %}
    <tr>
       <td><a href="/view/{{violation.pk}}">{{ violation.operator }} ({{ violation.country }}) {{ violation.contract }}</a>
          <div class="info-validate">
            <form method="get" id="{{ violation.pk }}" class="confirm_form" >
                <label>{% trans "In order to <strong>validate your action</strong>, please enter your email address" %}</label>
                <input type="text" name="email" />
                <input type="hidden" value="{{ violation.pk }}" />
                <input type="submit" value="{% trans "confirm" %}" />
                <input class="cancel-button" type="button" value="{% trans "cancel" %}" />
              </form>
            </div>
       </td>
      <td class='align-right'>{{ violation.confirmations }}</td>
      <td class='align-right'><div class="confirm"><a class="button">confirm</a></div>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>
</div>
{%endblock%}
